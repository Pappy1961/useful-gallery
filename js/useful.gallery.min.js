/*
	Source:
	van Creij, Maurice (2012). "useful.gallery.js: An scrolling content gallery.", version 20120606, http://www.woollymittens.nl/.

	License:
	This work is licensed under a Creative Commons Attribution 3.0 Unported License.

	Prerequisites:
	<script src="./js/useful.js"></script>
	<!--[if IE]>
		<script src="./js/html5.js"></script>
		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
		<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js"></script>
	<![endif]-->
*/// TODO: switch to more recent touch controls (useful.interaction.touch)
// TODO: make the idle timer independent of the mouse, so it may work on touch devices
(function(useful){"use strict";var gallery={};gallery={name:"gallery",start:function(e,t){if(!t.isActive){t.isActive=!0;e.className+=" gallery_mode_carousel";gallery.defaultSettings(e,t);gallery.slides.buildSlideContainer(t);gallery.progress.buildProgressIndicator(t);gallery.toolbar.buildToolbar(t);gallery.pager.buildPager(t);gallery.hint.buildHint(t);if(t.onMobile){gallery.toolbar.events.handleClicksiOS(t);gallery.events.handleGesturesiOS(t)}else{gallery.toolbar.events.handleClicks(t);gallery.events.handleGestures(t)}gallery.events.handleMousewheel(t);gallery.events.handleIdle(t);gallery.toolbar.events.handleFilters(t);gallery.events.handleResize(t);t.allowAjax&&setTimeout(function(){gallery.slides.loadSlides(t,t.activeSlide,t.fetchAmount);gallery.pager.loadPager(t)},200);gallery.pager.fillPager({responseText:"["+(t.slideNodes.length-1)+"]"},t);gallery.updateAll(t)}},defaultSettings:function(e,t){t.aspectRatio=t.aspectRatio||1;t.carouselNames=t.carouselNames||["gallery_carousel_farleft","gallery_carousel_left","gallery_carousel_centre","gallery_carousel_right","gallery_carousel_farright"];t.pinboardNames=t.pinboardNames||["gallery_pinboard_left","gallery_pinboard_right","gallery_pinboard_loading"];t.pagerLabels=t.pagerLabels||["Lorem","Ipsum","Dolor","Sit","Amet"];t.rowOffset=t.rowOffset||18;t.pinboardOffset=t.pinboardOffset||0;t.fetchScrollBottom=t.fetchScrollBottom||100;t.fetchTreshold=t.fetchTreshold||3;t.fetchAmount=t.fetchAmount||5;t.limitSpeed=t.limitSpeed||!0;t.allowLoop=t.allowLoop||!1;t.idleDelay=t.idleDelay||8e3;t.idleDirection=t.idleDirection||1;t.toggleHint=t.toggleHint||!0;t.togglePager=t.togglePager||!0;t.toggleFilter=t.toggleFilter||"Filter";t.togglePinboard=t.togglePinboard||"View Pin Board";t.toggleCarousel=t.toggleCarousel||"View Carousel";t.toggleNext=t.toggleNext||"Next Slide";t.togglePrev=t.togglePrev||"Previous Slide";t.onMobile=t.onMobile||navigator.userAgent.indexOf("Mobile")>-1;t.parent=e;t.activeSlide=0;t.activeFilterGroup=[];t.carouselMode=e.className.indexOf("gallery_mode_carousel")>-1;t.allowAjax=t.allowAjax||e.getElementsByTagName("form").length>0;t.animationInProgress=!1;t.fetchInProgress=!1;t.noSlidesLeft=!1;t.recentGesture=!1},updateAll:function(e){e.parent.style.height=parseInt(e.parent.offsetWidth*e.aspectRatio,10)+"px";gallery.pager.updatePager(e);gallery.slides.updateSlides(e);gallery.toolbar.updateToolbar(e)},resetAll:function(e){e.activeSlide=0;e.slideNodes=[];e.fetchInProgress=!1;e.fetchInProgress=!1;e.noSlidesLeft=!1;e.slideContainer.innerHTML="";gallery.slides.loadSlides(e,0,3)},slides:{buildSlideContainer:function(e){var t,n,r;e.slideNodes=useful.css.select("figure, article",e.parent);e.slideContainer=document.createElement("div");e.slideContainer.className="gallery_slides";for(t=0,n=e.slideNodes.length;t<n;t+=1){r=e.parent.removeChild(e.slideNodes[t]);r.className+=" "+e.carouselNames[e.carouselNames.length-1];e.slideContainer.appendChild(r)}e.parent.appendChild(e.slideContainer)},loadSlides:function(e,t,n){if(e.allowAjax){var r,i,s,o,u,a,f;if(!e.fetchInProgress&&!e.noSlidesLeft){s=t?t:e.activeSlide;o=n?n:e.fetchAmount;u=e.parent.getElementsByTagName("form")[0];a=u.getElementsByTagName("input");e.activeFilterGroup=[];for(r=0,i=a.length;r<i;r+=1)if(a[r].checked||!a[r].type.match(/checkbox|radio/gi))e.activeFilterGroup[e.activeFilterGroup.length]=a[r].value;f=u.getAttribute("action");f+="&idx="+s+"&amt="+o+"&grp="+e.activeFilterGroup.join(",");useful.request.send({url:f,post:null,onProgress:function(t){gallery.slides.progressSlides(t,e)},onFailure:function(){},onSuccess:function(t){gallery.slides.insertSlides(t,e)}});e.progressTimeout=setTimeout(function(){e.progressIndicator.style.display="block"},500);e.fetchInProgress=!0;setTimeout(function(){e.fetchInProgress=!1;e.progressIndicator.style.display="none"},1e3)}}},progressSlides:function(){},insertSlides:function(e,t){var n,r,i,s,o;s=[];if(t.allowAjax){s=useful.request.decode(e.responseText);for(n=0,r=s.length-1;n<r;n+=1){o=s[n];i=document.createElement(o.element);i.id=o.id;i.className=o["class"];i.innerHTML=decodeURI(o.html);if(!document.getElementById(i.id)){i.className+=t.carouselMode?" "+t.carouselNames[t.carouselNames.length-1]:" "+t.pinboardNames[t.pinboardNames.length-1];t.slideContainer.appendChild(i);i.style.marginLeft="-"+Math.round(i.offsetWidth/2)+"px";i.style.marginTop="-"+Math.round(i.offsetHeight/2)+"px"}}s.length<=1&&(t.noSlidesLeft=!0);t.fetchInProgress=!1;clearTimeout(t.progressTimeout);t.progressIndicator.style.display="none";gallery.slides.updateSlides(t);t.carouselMode||gallery.toolbar.transformToPinboard(t);gallery.pager.fillPager(e,t)}},updateSlides:function(e){var t,n,r,i,s,o,u;e.slideNodes=useful.css.select("figure, article",e.slideContainer);o=Math.floor(e.carouselNames.length/2);u=function(){e.animationInProgress=!1};for(t=0,n=e.slideNodes.length;t<n;t+=1){if(e.slideNodes[t].className.indexOf("slide_active")<0){e.onMobile?gallery.slides.events.handleSlideiOS(t,e):gallery.slides.events.handleSlide(t,e);e.slideNodes[t].className="slide_active "+e.slideNodes[t].className}if(e.carouselMode){s=t-e.activeSlide+o;s=e.allowLoop&&t-e.activeSlide-o>0?t-e.slideNodes.length-e.activeSlide+o:s;s=e.allowLoop&&t-e.activeSlide+o<0?t+e.slideNodes.length-e.activeSlide+o:s;s=s<0?0:s;s=s>=e.carouselNames.length?e.carouselNames.length-1:s;if(e.slideNodes[t].className.indexOf(e.carouselNames[s])<0){e.limitSpeed&&(e.animationInProgress=!0);useful.css.setClass(e.slideNodes[t],e.carouselNames.join(" "),e.carouselNames[s],u)}r=e.slideNodes[t].offsetWidth;i=e.slideNodes[t].offsetHeight;e.slideNodes[t].style.marginLeft=parseInt(r/-2,10)+"px";e.slideNodes[t].style.marginTop=parseInt(i/-2,10)+"px"}else{var a=e.pinboardNames.length-1;useful.css.setClass(e.slideNodes[t],e.pinboardNames.join(" "),e.pinboardNames[t%a],u)}}e.carouselMode||gallery.toolbar.transformToPinboard(e)},slideBy:function(e,t){e.activeSlide=e.activeSlide+t;if(e.activeSlide>e.slideNodes.length-1){e.activeSlide=e.slideNodes.length-1;e.allowLoop&&(e.activeSlide=0)}if(e.activeSlide<0){e.activeSlide=0;e.allowLoop&&(e.activeSlide=e.slideNodes.length-1)}e.slideNodes.length-e.activeSlide<e.fetchTreshold&&gallery.slides.loadSlides(e);gallery.updateAll(e)},slideTo:function(e,t){e.activeSlide=t;e.slideNodes.length-e.activeSlide<e.fetchTreshold&&gallery.slides.loadSlides(e);gallery.updateAll(e)},events:{handleSlide:function(e,t){useful.events.add(t.slideNodes[e],"click",function(n){if(t.carouselMode)if(!t.recentGesture)if(e===t.activeSlide){var r=t.slideNodes[t.activeSlide].getElementsByTagName("a");r.length===1&&(document.location.href=r[0].href)}else gallery.slides.slideTo(t,e);else useful.events.cancel(n)})},handleSlideiOS:function(e,t){useful.events.add(t.slideNodes[e],"touchend",function(n){if(t.carouselMode)if(!t.recentGesture)if(e===t.activeSlide){var r=t.slideNodes[t.activeSlide].getElementsByTagName("a");r.length===1&&(document.location.href=r[0].href)}else gallery.slides.slideTo(t,e);else n.preventDefault()})}}},progress:{buildProgressIndicator:function(e){e.progressIndicator=document.createElement("div");e.progressIndicator.className="gallery_busy";e.parent.appendChild(e.progressIndicator)}},toolbar:{buildToolbar:function(e){var t,n,r;e.toolbarContainer=document.createElement("menu");e.toolbarContainer.className="gallery_toolbar";e.toolbarElements=[];e.togglePrev&&e.toolbarElements.push([e.togglePrev,"gallery_tool_previous"]);e.toggleNext&&e.toolbarElements.push([e.toggleNext,"gallery_tool_next"]);e.toggleCarousel&&e.toolbarElements.push([e.toggleCarousel,"gallery_tool_carousel"]);e.togglePinboard&&e.toolbarElements.push([e.togglePinboard,"gallery_tool_pinboard"]);e.toggleFilter&&e.toolbarElements.push([e.toggleFilter,"gallery_tool_filter"]);for(t=0,n=e.toolbarElements.length;t<n;t+=1)if(e.toolbarElements[t][0]!==null){r=document.createElement("button");r.innerHTML=e.toolbarElements[t][0];r.className=e.toolbarElements[t][1]+" gallery_tool_enabled";e.toolbarContainer.appendChild(r)}e.parent.appendChild(e.toolbarContainer)},updateToolbar:function(e){if(!e.allowLoop&&e.previousButton&&e.nextButton){e.previousButton.className=e.activeSlide===0?e.previousButton.className.replace(/gallery_tool_enabled/gi,"gallery_tool_disabled"):e.previousButton.className.replace(/gallery_tool_disabled/gi,"gallery_tool_enabled");e.nextButton.className=e.activeSlide===e.slideNodes.length-1?e.nextButton.className.replace(/gallery_tool_enabled/gi,"gallery_tool_disabled"):e.nextButton.className.replace(/gallery_tool_disabled/gi,"gallery_tool_enabled")}},toggleFilter:function(e,t){t.filterForm=t.filterForm||t.parent.getElementsByTagName("form");if(t.filterForm.length>0)if(t.filterForm[0].className.indexOf("gallery_filter_hide")>-1){e.parentNode.className=e.parentNode.className.replace("Passive","Active");useful.css.setClass(t.filterForm[0],"gallery_filter_hide","gallery_filter_show",null,null,null,null)}else{e.parentNode.className=e.parentNode.className.replace("Active","Passive");useful.css.setClass(t.filterForm[0],"gallery_filter_show","gallery_filter_hide",null,null,null,null)}},transformToPinboard:function(e){var t,n,r,i,s,o;r=e.carouselMode?!0:!1;if(e.slideNodes.length>0){clearTimeout(e.transformTimeout);e.slideNodes[0].parentNode.style.visibility="hidden";e.transformTimeout=setTimeout(function(){e.slideNodes[0].parentNode.style.visibility="visible"},1e3)}useful.css.setClass(e.parent,"gallery_mode_carousel","gallery_mode_pinboard");e.carouselMode=!1;i=e.pinboardNames.length-1;for(t=0,n=e.slideNodes.length;t<n;t+=1)useful.css.setClass(e.slideNodes[t],e.carouselNames.join(" "),e.pinboardNames[t%i]);s=[];for(t=0,n=e.slideNodes.length;t<n;t+=1){t<i&&(s[t]=e.rowOffset+e.pinboardOffset);o=e.slideNodes[t].offsetHeight+e.rowOffset;e.slideNodes[t].style.top=s[t%i]+"px";s[t%i]+=o}r&&(e.slideContainer.scrollTop=0);e.slideContainer.scrollHeight<=e.slideContainer.offsetHeight&&gallery.slides.loadSlides(e,e.slideNodes.length,e.fetchAmount)},transformToCarousel:function(e){var t;e.slideContainer.scrollTop=0;if(e.slideNodes.length>0){clearTimeout(e.transformTimeout);e.slideNodes[0].parentNode.style.visibility="hidden";e.transformTimeout=setTimeout(function(){e.slideNodes[0].parentNode.style.visibility="visible"},1e3)}useful.css.setClass(e.parent,"gallery_mode_pinboard","gallery_mode_carousel");e.carouselMode=!0;for(var n=0,r=e.slideNodes.length;n<r;n+=1){t=n+2<e.carouselNames.length?e.carouselNames[n+2]:e.carouselNames[e.carouselNames.length-1];e.slideNodes[n].style.top="50%";useful.css.setClass(e.slideNodes[n],e.pinboardNames.join(" "),t)}e.activeSlide=0;gallery.updateAll(e)},events:{handleFilters:function(e){var t,n,r,i,s;r=e.parent.getElementsByTagName("form");if(r.length>0){i=r[0].getElementsByTagName("input");s=navigator.userAgent.match(/msie/gi)?"click":"change";for(t=0,n=i.length;t<n;t+=1){i[t].checked=!0;gallery.toolbar.events.handleFilter(i[t],s,e)}}},handleFilter:function(e,t,n){useful.events.set(e,t,function(){gallery.resetAll(n)})},handleClicks:function(e){var t,n,r;r=e.toolbarContainer.getElementsByTagName("button");for(t=0,n=r.length;t<n;t+=1)gallery.toolbar.events.handleClick(r[t],e)},handleClick:function(e,t){switch(e.className.split(" ")[0]){case"gallery_tool_previous":t.previousButton=e;useful.events.set(e,"click",function(e){t.animationInProgress||gallery.slides.slideBy(t,-1);useful.events.cancel(e)});break;case"gallery_tool_next":t.nextButton=e;useful.events.set(e,"click",function(e){t.animationInProgress||gallery.slides.slideBy(t,1);useful.events.cancel(e)});break;case"gallery_tool_pinboard":t.pinboardButton=e;useful.events.set(e,"click",function(e){gallery.toolbar.transformToPinboard(t);useful.events.cancel(e)});break;case"gallery_tool_carousel":t.carouselButton=e;useful.events.set(e,"click",function(e){gallery.toolbar.transformToCarousel(t);useful.events.cancel(e)});break;case"gallery_tool_filter":t.filterButton=e;useful.events.set(e,"click",function(n){gallery.toolbar.toggleFilter(e,t);useful.events.cancel(n)})}},handleClicksiOS:function(e){var t,n,r;r=e.toolbarContainer.getElementsByTagName("button");for(t=0,n=r.length;t<n;t+=1)gallery.toolbar.events.handleClickiOS(r[t],e)},handleClickiOS:function(e,t){switch(e.className.split(" ")[0]){case"gallery_tool_previous":t.previousButton=e;useful.events.set(e,"touchend",function(e){t.animationInProgress||gallery.slides.slideBy(t,-1);e.preventDefault()},!1);break;case"gallery_tool_next":t.nextButton=e;useful.events.set(e,"touchend",function(e){t.animationInProgress||gallery.slides.slideBy(t,1);e.preventDefault()},!1);break;case"gallery_tool_pinboard":t.pinboardButton=e;useful.events.set(e,"touchend",function(e){gallery.toolbar.transformToPinboard(t);e.preventDefault()},!1);break;case"gallery_tool_carousel":t.carouselButton=e;useful.events.set(e,"touchend",function(e){gallery.toolbar.transformToCarousel(t);e.preventDefault()},!1);break;case"gallery_tool_filter":t.filterButton=e;useful.events.set(e,"touchend",function(n){gallery.toolbar.toggleFilter(e,t);n.preventDefault()})}}}},pager:{buildPager:function(e){e.pagerContainer=document.createElement("menu");e.pagerContainer.className="gallery_pager";e.parent.appendChild(e.pagerContainer)},loadPager:function(e){var t;t=e.parent.getElementsByTagName("form")[0].getAttribute("action");t+="&inf=1&grp="+e.activeFilterGroup.join(",");useful.request.send({url:t,post:null,onProgress:function(){},onFailure:function(){},onSuccess:function(t){gallery.pager.fillPager(t,e)}})},fillPager:function(e,t){var n,r,i,s,o,u;i=e.referer;s=[];s=useful.request.decode(e.responseText);t.pagerContainer.innerHTML="";for(n=0,r=s[s.length-1]+1;n<r;n+=1){o=document.createElement("li");u=document.createElement("a");u.innerHTML=t.pagerLabels!==null&&n<t.pagerLabels.length?t.pagerLabels[n]:n+1;o.appendChild(u);t.pagerContainer.appendChild(o);u.setAttribute("href","#gallery_slide_"+n);u.setAttribute("id","gallery_page_"+n);t.onMobile?gallery.pager.events.handlePageriOS(n,u,t):gallery.pager.events.handlePager(n,u,t)}gallery.pager.updatePager(t)},updatePager:function(e){var t,n,r;r=e.pagerContainer.getElementsByTagName("a");for(t=0,n=r.length;t<n;t+=1)t<e.slideNodes.length?r[t].parentNode.className=t===e.activeSlide?"gallery_pager_active":"gallery_pager_link":r[t].parentNode.className="gallery_pager_passive";e.togglePager||(e.pagerContainer.style.visibility="hidden")},events:{handlePager:function(e,t,n){useful.events.set(t,"click",function(r){!n.animationInProgress&&t.parentNode.className.match(/gallery_pager_link/gi)&&gallery.slides.slideTo(n,e);useful.events.cancel(r)})},handlePageriOS:function(e,t,n){useful.events.set(t,"touchend",function(r){!n.animationInProgress&&t.parentNode.className.match(/gallery_pager_link/gi)&&gallery.slides.slideTo(n,e);useful.events.cancel(r)})}}},hint:{buildHint:function(e){if(e.toggleHint){e.hintElement=document.createElement("div");e.hintElement.className="gallery_hint";e.parent.appendChild(e.hintElement);e.parent.className+=" gallery_interface_hidden";e.onMobile&&gallery.hint.events.handleHintiOS(e)}},events:{handleHintiOS:function(e){useful.events.add(e.parent,"touchend",function(){e.parent.className=e.parent.className.replace(/gallery_interface_hidden/gi,"gallery_interface_visible")})}}},events:{handleResize:function(e){useful.events.add(window,"resize",function(){gallery.updateAll(e)})},handleGestures:function(e){e.startX=null;useful.events.set(e.parent,"mousedown",function(t){t=t||window.event;if(e.carouselMode){e.startX=navigator.userAgent.indexOf("MSIE ")>-1?t.x:t.screenX;useful.events.cancel(t)}});useful.events.set(e.parent,"mousemove",function(t){t=t||window.event;if(e.carouselMode&&e.startX!==null){var n;e.recentGesture=!0;e.endX=navigator.userAgent.indexOf("MSIE ")>-1?t.x:t.screenX;if(Math.abs(e.endX-e.startX)>e.parent.offsetWidth/4){n=e.endX-e.startX<0?1:-1;e.animationInProgress||gallery.slides.slideBy(e,n);e.startX=e.endX}useful.events.cancel(t)}});useful.events.set(e.parent,"mouseup",function(t){t=t||window.event;if(e.carouselMode){e.endX=null;e.startX=null;setTimeout(function(){e.recentGesture=!1},100);useful.events.cancel(t)}});useful.events.add(e.parent,"mouseout",function(t){t=t||window.event;if(e.carouselMode){e.timeOut=setTimeout(function(){e.endX=null;e.startX=null},100);useful.events.cancel(t)}});useful.events.add(e.parent,"mouseover",function(t){t=t||window.event;if(e.carouselMode){clearTimeout(e.timeOut);useful.events.cancel(t)}})},handleGesturesiOS:function(e){e.touchStartX=null;e.touchStartY=null;useful.events.add(e.parent,"touchstart",function(t){if(e.carouselMode){e.touchStartX=t.touches[0].pageX;e.touchStartY=t.touches[0].pageY}},!1);useful.events.add(e.parent,"touchmove",function(t){if(e.carouselMode&&e.touchStartX!==null){e.recentGesture=!0;e.touchEndX=t.touches[0].pageX;e.touchEndY=t.touches[0].pageY;if(Math.abs(e.touchEndX-e.touchStartX)>e.parent.offsetWidth/4){var n=e.touchEndX-e.touchStartX<0?1:-1;e.animationInProgress||gallery.slides.slideBy(e,n);e.touchStartX=e.touchEndX}Math.abs(e.touchEndX-e.touchStartX)>Math.abs(e.touchEndY-e.touchStartY)&&t.preventDefault()}},!1);useful.events.add(e.parent,"touchend",function(){if(e.carouselMode){e.touchEndX=null;e.touchStartX=null;e.touchEndY=null;e.touchStartY=null;setTimeout(function(){e.recentGesture=!1},100)}},!1);useful.events.add(e.parent,"touchcancel",function(t){if(e.carouselMode){e.touchEndX=null;e.touchStartX=null;e.touchEndY=null;e.touchStartY=null;setTimeout(function(){e.recentGesture=!1},100);t.preventDefault()}},!1)},handleMousewheel:function(e){useful.events.set(e.parent,"mousewheel",function(t){var n,r;n=window.event?window.event.wheelDelta/120:-t.detail/3;r=n<0?1:-1;if(e.carouselMode){e.animationInProgress||gallery.slides.slideBy(e,r);useful.events.cancel(t)}});useful.events.set(e.slideContainer,"scroll",function(){e.slideContainer.scrollHeight-e.slideContainer.offsetHeight-e.slideContainer.scrollTop<e.fetchScrollBottom&&gallery.slides.loadSlides(e,e.slideNodes.length,e.fetchAmount)})},handleIdle:function(e){e.idleTimer=null;e.idleLoop=e.allowLoop;useful.events.add(e.parent,"mouseout",function(){e.allowLoop=!0;if(e.idleDelay>-1){clearInterval(e.idleTimer);e.idleTimer=setInterval(function(){e.carouselMode&&gallery.slides.slideBy(e,e.idleDirection)},e.idleDelay)}});useful.events.add(e.parent,"mouseover",function(){e.allowLoop=e.idleLoop;clearInterval(e.idleTimer)});if(e.idleDelay>-1){clearInterval(e.idleTimer);e.idleTimer=setInterval(function(){e.carouselMode&&gallery.slides.slideBy(e,e.idleDirection)},e.idleDelay)}}}};useful.events=useful.events||{};useful.events.add=function(e,t,n){t=navigator.userAgent.match(/Firefox/i)&&t.match(/mousewheel/i)?"DOMMouseScroll":t;"addEventListener"in e?e.addEventListener(t,n,!1):"attachEvent"in e?e.attachEvent("on"+t,function(e){n(e)}):e["on"+t]=n};useful.events.set=function(e,t,n){useful.events.remove(e,t,n);useful.events.add(e,t,n)};useful.events.remove=function(e,t,n){t=navigator.userAgent.match(/Firefox/i)&&t.match(/mousewheel/i)?"DOMMouseScroll":t;e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent?e.detachEvent("on"+t,n):e["on"+t]=null};useful.events.cancel=function(e){e&&(e.preventDefault?e.preventDefault():e.preventManipulation?e.preventManipulation():e.returnValue=!1)};useful.request=useful.request||{};useful.request.send=function(e){var t;t=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");t.onreadystatechange=function(){useful.request.update(t,e)};if(e.post){t.open("POST",e.url,!0);t.setRequestHeader("Content-type","application/x-www-form-urlencoded");t.setRequestHeader("Content-length",e.post.length);t.setRequestHeader("Connection","close");try{t.send(e.post)}catch(n){e.onFailure({readyState:-1,status:-1,statusText:n})}}else{t.open("GET",e.url,!0);try{t.send()}catch(n){e.onFailure({readyState:-1,status:-1,statusText:n})}}};useful.request.update=function(e,t){if(e.readyState===4)switch(e.status){case 200:t.onSuccess(e,t);break;case 304:t.onSuccess(e,t);break;default:t.onFailure(e,t)}else t.onProgress(e,t)};useful.request.decode=function(text){var object;object={};typeof jQuery!="undefined"?object=jQuery.parseJSON(text):typeof JSON!="undefined"&&typeof JSON.parse!="undefined"?object=JSON.parse(text):typeof jsonParse!="undefined"?object=jsonParse(text):eval("object = "+text);return object};useful.models=useful.models||{};useful.models.clone=function(e){var t,n;if(typeof Object.create!="undefined")t=Object.create(e);else{n=function(){};n.prototype=e;t=new n}return t};useful.models.trim=function(e){return e.replace(/^\s+|\s+$/g,"")};useful.css=useful.css||{};useful.css.select=function(e,t){var n,r,i;t=t||document;e=typeof e=="string"?{rule:e,parent:t}:e;e.parent=e.parent||document;e.data=e.data||{};i=typeof document.querySelectorAll!="undefined"?e.parent.querySelectorAll(e.rule):typeof jQuery!="undefined"?jQuery(e.parent).find(e.rule).get():[];if(typeof e.handler=="undefined")return i;for(n=0,r=i.length;n<r;n+=1)e.handler(i[n],useful.models.clone(e.data))};useful.css.prefix=function(e){return navigator.userAgent.match(/webkit/gi)?"webkit"+e.substr(0,1).toUpperCase()+e.substr(1):navigator.userAgent.match(/firefox/gi)?"Moz"+e.substr(0,1).toUpperCase()+e.substr(1):navigator.userAgent.match(/microsoft/gi)?"ms"+e.substr(0,1).toUpperCase()+e.substr(1):navigator.userAgent.match(/opera/gi)?"O"+e.substr(0,1).toUpperCase()+e.substr(1):e};useful.css.compatibility=function(){var e,t,n;t=document.createElement("div");typeof t.style.MozTransition!="undefined"&&(e="transitionend");try{document.createEvent("OTransitionEvent");e="oTransitionEnd"}catch(r){n=null}try{document.createEvent("WebKitTransitionEvent");e="webkitTransitionEnd"}catch(r){n=null}try{document.createEvent("transitionEvent");e="transitionend"}catch(r){n=null}t=n;return e};useful.css.setClass=function(e,t,n,r,i,s){var o,u,a,f;r=r||function(){};a=useful.css.compatibility();o=new RegExp(useful.models.trim(t).replace(/ {2,}/g," ").split(" ").join("|"),"g");u=new RegExp(n,"g");if(typeof a!="undefined"){e.addEventListener(a,f=function(){r();e.removeEventListener(a,f,!0)},!0);e.className=useful.models.trim(e.className.replace(o,"")+" "+n).replace(/ {2,}/g," ")}else if(typeof jQuery!="undefined"&&typeof jQuery.ui!="undefined"){i=i||500;s=s||"swing";jQuery(e).switchClass(t.replace(u,""),n,i,s,r)}else{e.className=useful.models.trim(e.className.replace(o,"")+" "+n).replace(/ {2,}/g," ");r()}};useful.gallery={};useful.gallery.start=gallery.start})(window.useful=window.useful||{});